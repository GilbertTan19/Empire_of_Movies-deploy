<!DOCTYPE html>
<html lang="en">
<head>
  <title>{% block title %}Empire of Movies{% endblock title %}</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
  .bootstrap-select:not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {
    width: 50px;
  }

    .bootstrap-select .dropdown-toggle .filter-option {
    position: absolute;
    top: 0;
    left: 0;
    padding-top: inherit;
    padding-right: inherit;
    padding-bottom: inherit;
    padding-left: inherit;
    height: 100%;
    width: 0%;
    text-align: left;
    }
    .bootstrap-select > .dropdown-toggle {
    position: relative;
    width: 50px;
    z-index: 1;
    text-align: center;
    white-space: nowrap;
    }
  </style>


</head>
<body>
<nav class="navbar navbar-expand-md bg-dark navbar-dark">
  <a class="navbar-brand" href="{% url 'home' %}">Empire of Movies</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>  
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    {% if user.is_authenticated %}
      <form class="form-inline" action="{% url 'search_results' %}" method="get">
        <input name="q" class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
          <select name="filter" class="selectpicker" multiple placeholder="Filter By:">
            <option value="user_search" selected>User</option>
            <option value="title" selected>Title</option>
            <option value="year" selected>Year</option>
            <option value="synopsis" selected>Synopsis</option>
            <option value="stars" selected>Stars</option>
            <option value="genres" selected>Genre</option>
            <option value="keywords" selected>Keywords</option>
          </select>
      </form>
      <ul class="navbar-nav mx-auto">
        <li class="nav-item"><a class="nav-link" href="{% url 'movie_followed' %}">Followed Movies</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'movie_list' %}">All Movies</a></li>
        <li class="nav-item"><a class="nav-link" href="{%url 'movie_request'%}"> Request Movie </a> </li>
      </ul>
      <ul class="navbar-nav ml-auto">
        <li><a class="nav-link" href="{% url 'telegram_otp'%}">Connect to Telegram</a></li>
        {% if user.have_notification %}
          <li class="nav-item dropdown">
            <a class="nav-link  text-danger" href="#" id="navbardrop" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Notifications</a>
            <div class="dropdown-menu dropdown-menu-right">
              <div class="dropdown-item">
                <form class ='form', method='POST' action = '{% url "notification_clear_all" %}'> {% csrf_token %}
                    <button class='btn btn-danger'>
                      Clear All
                    </button>
                </form> 
              </div>
              {% for notification in user.all_notification %}
                
                <div class="dropdown-item d-flex flex-row">
                
                  {% if notification.movie_title %}
                  
                    <div class="p-2">{{notification.title}} <a href="{{ notification.movie_link }}">{{ notification.movie_title }}</a> with title <a href="{{ notification.inside_link }}">{{ notification.inside_title }}</a></div>
                    
                  {% else %}
                    <div class="p-2">{{notification.title}}</div>
                  {% endif %}
                  <div>
                  <form class ='form', method='POST' action = '{% url "notification_clear" %}'> {% csrf_token %}
                                <input type='hidden' name ='pk' value='{{ notification.pk }}'/>
                                <button class='btn p-2'>
                                  <span class="close">&times;</span>
                                </button>
                    </form>
                  </div>
                  
                </div>
              {% endfor %}
            </div>
          </li>
        {% else %}
          <li class="nav-item dropdown">
            <a class="nav-link " href="#" id="navbardrop" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Notifications</a>
              <div class="dropdown-menu dropdown-menu-right">
                  <p class="dropdown-item disabled">You have no notification</p>
                </div>
          </li>
              
        {% endif %}
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{user.username}}</a>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="{{user.get_absolute_url}}">Profile</a>
            <a class="dropdown-item" href="{% url 'update_profile'%}">Update Profile</a>
            <a class="dropdown-item" href="{% url 'account_change_password'%}">Change Password</a>
            <a class="dropdown-item" href="{%url 'account_logout'%}">Log out</a>
          </div>
        </li>
      </ul>
    {% else %}
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item"><a class="btn btn-outline-secondary" href="{% url 'account_login' %}"><span class="glyphicon glyphicon-log-in"></span>Log in</a></li>
        
        <li class="nav-item"><a class="btn btn-primary ml-2" href="{% url 'account_signup' %}"><span class="glyphicon glyphicon-user"></span>Sign up</a> </li>
      </ul>
    {% endif %}
  </div>  
</nav>
<br>

    <div class="container">
      {% block content %}
      {% endblock content %}
    </div>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  {% comment %} <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> {% endcomment %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  {% comment %} <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script> {% endcomment %}
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script> 
 
</body>
</html>


